---
import BaseLayout from '../../../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';

export async function getStaticPaths() {
  const posts = await getCollection('posts');
  const tags = [...new Set(posts.flatMap(post => post.data.tags || []))];
  
  return tags.map(tag => ({
    params: { tag },
    props: { 
      posts: posts.filter(post => post.data.tags?.includes(tag)),
      tag 
    }
  }));
}

const { posts, tag } = Astro.props;
---

<BaseLayout title={`–ü–æ—Å—Ç—ã —Å —Ç–µ–≥–æ–º: ${tag}`} description={`–í—Å–µ –ø–æ—Å—Ç—ã –±–ª–æ–≥–∞ —Å —Ç–µ–≥–æ–º "${tag}"`}>
  <div style="padding: 2.5rem 1rem;">
    <div style="max-width: 1200px; margin: 0 auto;">
      <div style="text-align: center; margin-bottom: 2rem;">
        <h1 style="font-weight: 800; font-size: 2rem; margin-bottom: 0.5rem;">üè∑Ô∏è –¢–µ–≥: {tag}</h1>
        <p style="color: var(--text-secondary);">–ù–∞–π–¥–µ–Ω–æ –ø–æ—Å—Ç–æ–≤: <span style="display: inline-block; background-color: #dbeafe; color: #1e40af; padding: 0.25rem 0.75rem; border-radius: 0.375rem; font-weight: 600;">{posts.length}</span></p>
      </div>

      {posts.length > 0 ? (
        <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 1.5rem; margin-bottom: 2rem;">
          {posts.map((post, idx) => {
            const colors = [
              { bg: 'rgba(37, 99, 235, 0.1)', border: '#2563eb', text: '#2563eb' },
              { bg: 'rgba(234, 88, 12, 0.1)', border: '#ea580c', text: '#ea580c' },
              { bg: 'rgba(147, 51, 234, 0.1)', border: '#9333ea', text: '#9333ea' },
            ];
            const color = colors[idx % colors.length];
            
            return (
              <div style={`background-color: var(--bg-main); padding: 1.5rem; border-radius: 0.5rem; border: 2px solid ${color.border}; transition: all 0.3s; cursor: pointer;`}
                onmouseover={`this.style.boxShadow = '0 8px 16px rgba(0,0,0,0.15)'; this.style.transform = 'translateY(-4px)';`}
                onmouseout={`this.style.boxShadow = 'none'; this.style.transform = 'translateY(0)';`}>
                <h3 style={`font-weight: 700; font-size: 1.125rem; margin-bottom: 0.5rem; color: ${color.text};`}>
                  <a href={`/blog/${post.data.slug}`} style={`color: ${color.text}; text-decoration: none;`}>{post.data.title}</a>
                </h3>
                <p style="font-size: 0.875rem; color: var(--text-secondary); line-height: 1.5; margin-bottom: 1rem;">{post.data.description}</p>
                <div style="display: flex; justify-content: space-between; align-items: flex-end; gap: 1rem;">
                  <time style="font-size: 0.875rem; color: var(--text-secondary);">{new Date(post.data.publishDate).toLocaleDateString('ru-RU', { year: 'numeric', month: 'long', day: 'numeric' })}</time>
                  {post.data.tags && post.data.tags.length > 0 && (
                    <div style="display: flex; gap: 0.5rem; flex-wrap: wrap; justify-content: flex-end;">
                      {post.data.tags.map((t) => {
                        const tagColorIdx = Math.abs(t.charCodeAt(0)) % 3;
                        const tagColors = ['#dbeafe', 'rgba(234, 88, 12, 0.15)', 'rgba(147, 51, 234, 0.15)'];
                        const tagTextColors = ['#1e40af', '#ea580c', '#9333ea'];
                        return (
                          <a href={`/blog/tags/${t}`} style={`padding: 0.25rem 0.75rem; font-size: 0.75rem; border-radius: 0.375rem; text-decoration: none; background-color: ${t === tag ? color.border : tagColors[tagColorIdx]}; color: ${t === tag ? 'white' : tagTextColors[tagColorIdx]}; font-weight: 600; display: inline-block;`}>{t}</a>
                        );
                      })}
                    </div>
                  )}
                </div>
              </div>
            );
          })}
        </div>
      ) : (
        <div style="text-align: center; padding: 2rem;">
          <p style="color: var(--text-secondary); font-size: 1.125rem; margin-bottom: 1rem;">–ü–æ—Å—Ç–æ–≤ —Å —Ç–µ–≥–æ–º "{tag}" –ø–æ–∫–∞ –Ω–µ—Ç.</p>
          <a href="/blog" style="padding: 0.75rem 1.5rem; background-color: var(--primary-color); color: white; border-radius: 0.375rem; text-decoration: none; font-weight: 500; display: inline-block;">‚Üê –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ –±–ª–æ–≥—É</a>
        </div>
      )}

      <div style="margin-top: 2rem; padding-top: 2rem; border-top: 1px solid var(--border-color);">
        <a href="/blog/tags" style="color: var(--primary-color); text-decoration: none; font-weight: 500;">‚Üê –í—Å–µ —Ç–µ–≥–∏</a>
      </div>
    </div>
  </div>
</BaseLayout>
